<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Release Notes for STM32 Middleware WPAN</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="_htmresc/mini-st_2020.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link rel="icon" type="image/x-icon" href="./_htmresc/favicon.png" />
</head>
<body>
<div class="row">
<div class="col-sm-12 col-lg-4">
<center>
<h1 id="release-notes-for">Release Notes for</h1>
<h1 id="stm32-middleware-wpan"><mark>STM32 Middleware WPAN</mark></h1>
<p>Copyright © 2022 STMicroelectronics<br />
</p>
<a href="https://www.st.com" class="logo"><img src="_htmresc/st_logo_2020.png" alt="ST logo" /></a>
</center>
<h1 id="purpose">Purpose</h1>
<p>Wireless Personal Area Network Middleware supporting:</p>
<ul>
<li><p>Bluetooth Low Energy 5.4</p></li>
<li><p>Zigbee stack Revision 23 (R23) and Revision 22 (R22), Zigbee Clusters ZCL 8.0</p></li>
<li><p>OpenThread: compliant Thread 1.1, 1.2 and 1.3  </p></li>
<li><p>Mac 802.15.4: compliant Zigbee IEEE 802.15.4 MAC Test Plan V 2.0</p></li>
<li><p>BLE-Thread and BLE-Zigbee dynamic concurrent modes</p></li>
<li><p>All libraries are compiled with MDK-ARM (KEIL) ARMCLANG V6.19 AEABI format.</p></li>
</ul>
<p>The following features are supported for <strong>BLE</strong> 5.4:</p>
<ul>
<li>Advertising</li>
<li>Scanning</li>
<li>Master / Slave Connection</li>
<li>Data length extension</li>
<li>Privacy</li>
<li>LE Encryption</li>
<li>Legacy Pairing, LE secure connections</li>
<li>2Mbit</li>
<li>Long Range</li>
<li>Channel Selection Algorithm #2</li>
<li>Direct Test Mode</li>
<li>GATT Client / Server</li>
<li>Extended Advertising/Scanning</li>
<li>Periodic Advertising/Synchronisation</li>
<li>Periodic Sync Transfer</li>
<li>GATT Caching</li>
<li>LE L2CAP Connection Oriented channel</li>
<li>Enhanced ATT</li>
<li>Isochronous Broadcaster / Synchronizer</li>
<li>Connected Isochronous</li>
<li>LE Power Control</li>
<li>Connection Subrating</li>
<li>Channel Classification Enhancement</li>
<li>Periodic Advertising Enhancement</li>
</ul>
<p>The maximum number of connections is limited to 20.</p>
<p>The list of BLE commands is documented in the following file: <a href="ble/stack/doc/STM32WBA_BLE_Wireless_Interface.html">STM32WBA_BLE_Wireless_Interface.html</a></p>
<p>The BLE Stack user manual is available at following location: <a href="ble/stack/doc/STM32WBA_BLE_Stack_User_Manual.html">STM32WBA_BLE_Stack_User_Manual.html</a></p>
<p>Different Bluetooth® Low Energy Host Stack variants are available in the STM32WBA package, depending on project requirements. Depending on the variant, the associated Link Layer library must be included in the project:</p>
<ul>
<li><em>stm32wba_ble_stack_full.a</em>: <strong>full host stack</strong> + <strong>ST LL controller</strong>, requires <em>LinkLayer_BLE_Full_lib.a</em> to work.</li>
<li><em>stm32wba_ble_stack_basic.a</em>: <strong>basic host stack</strong> + <strong>ST LL controller (basic features)</strong>, requires <em>LinkLayer_BLE_Basic_lib.a</em> or <em>LinkLayer_BLE_Basic_20_links_lib.a</em> to work.</li>
<li><em>stm32wba_ble_stack_llo.a</em>: <strong>ST LL controller only</strong>, requires <em>LinkLayer_BLE_Full_lib.a</em> to work.</li>
<li><em>stm32wba_ble_stack_llobasic.a</em>: <strong>ST LL controller (basic features)</strong> only, requires <em>LinkLayer_BLE_Basic_lib.a</em> or <em>LinkLayer_BLE_Basic_20_links_lib.a</em> to work.</li>
</ul>
<p>The <strong>BLE audio</strong> feature introduces the following libraries:</p>
<ul>
<li><em>ble_audio.a</em>: Generic Audio Framework.</li>
<li><em>LC3.a</em>: LC3 codec.</li>
<li><em>codec_mngr.a</em>: codec integration and data path management.</li>
<li>These libraries require the full feature BLE host stack and full feature link layer. (stm32wba_ble_stack_full.a).</li>
</ul>
<p>The following <strong>OpenThread</strong> libraries are provided:</p>
<ul>
<li><em>stm32wba_ot_ftd_lib.a</em> (Full Thread Device)<br />
</li>
<li><em>stm32wba_ot_mtd_lib.a</em> (Minimal Thread Device)</li>
</ul>
<p><strong>Zigbee</strong>:</p>
<ul>
<li>Stack:
<ul>
<li><em>ZigbeeProR23_FFD.a</em> (R23 Full Functional Device)</li>
<li><em>ZigbeeProR23_RFD.a</em> (R23 Reduced Functional Device)</li>
<li><em>ZigbeeProR22_FFD.a</em> (R22 Full Functional Device)</li>
<li><em>ZigbeeProR22_RFD.a</em> (R22 Reduced Functional Device)</li>
</ul></li>
<li>Clusters:
<ul>
<li>One cluster library for R23: <em>ZigbeeClusters.a</em> and one cluster library for R22: <em>ZigbeeClustersR22.a</em> containing the following clusters (ZCL 8.0 compliant). On demand, those clusters may be provided in source code.</li>
<li>List of generic clusters:
<ul>
<li>Alarm</li>
<li>Ballast Configuration</li>
<li>Basic</li>
<li>Color Control</li>
<li>Commissioning</li>
<li>Dehumidification Control</li>
<li>Device Temperature Configuration</li>
<li>Diagnostics<br />
</li>
<li>Door Lock</li>
<li>Electrical Measurement</li>
<li>Fan Control</li>
<li>Groups</li>
<li>Identify</li>
<li>Illuminance Level Sensing</li>
<li>Illuminance Measurement</li>
<li>Level</li>
<li>Meter Identification</li>
<li>Nearest Gateway</li>
<li>Occupancy Sensing</li>
<li>OnOff</li>
<li>OnOff Switch Configuration</li>
<li>Over-The-Air (OTA) Upgrade</li>
<li>Poll Control</li>
<li>Power Configuration<br />
</li>
<li>Power Profile<br />
</li>
<li>Pressure Measurement</li>
<li>Pump Configuration and Control<br />
</li>
<li>RSSI Location</li>
<li>Scenes</li>
<li>Temperature Measurement</li>
<li>Thermostat<br />
</li>
<li>Thermostat User Interface</li>
<li>Time</li>
<li>Voice Over Zigbee</li>
<li>Water Content Measurement</li>
<li>Window Covering<br />
</li>
</ul></li>
<li>List of Security Clusters:
<ul>
<li>Intruder Alarm Systems Ancillary Control Equipment (IAS_ACE)</li>
<li>Security IAS Warning Device (IAS_WD)</li>
<li>Security IAS Zone</li>
</ul></li>
<li>List of Smart Energy clusters:
<ul>
<li>Calendar</li>
<li>Device Management</li>
<li>Demand Response and Load Control</li>
<li>Energy Management</li>
<li>Events</li>
<li>Messaging</li>
<li>Metering</li>
<li>Prepayment</li>
<li>Price</li>
<li>Tunneling</li>
</ul></li>
</ul></li>
</ul>
</div>
<div class="col-sm-12 col-lg-8">
<h1 id="update-history">Update History</h1>
<div class="collapse">
<input type="checkbox" id="collapse-section4" checked aria-hidden="true"> <label for="collapse-section5" aria-hidden="false">V2.3.1 / 22-March-2024</label>
<div>
<h2 id="main-changes">Main Changes</h2>
<ul>
<li><p>Productive RF-PHY settings.</p></li>
<li>Zigbee:
<ul>
<li>Adding support of R22. (Stack and clusters)</li>
</ul></li>
<li>BLE:
<ul>
<li>ID 171974 : Fix issue of Confirm Indication when a Read Request is sent simultaneously</li>
<li>ID 173054 : Reject pairing with a peer device using debug public key</li>
<li>ID 174185 : Fix unaligned access memory on Keil with new MEMMOVE macro.</li>
</ul></li>
<li>BLE Audio:
<ul>
<li>ID 171331: libraries are not linked anymore with hardfp convention</li>
<li>Unicast Audio Start Procedure is not correctly ended if a disconnection with one of the CAP acceptors occurs during the Uniacst Audio Start Procedure</li>
<li>Fixed issue where CSIP expiring timer would cause Hardfault.<br />
</li>
<li>Added procedure check and clean to Broadcast Audio Start/Stop.</li>
</ul></li>
<li>802.15.4:
<ul>
<li>ID 166793: [Robustness] Assert during active scan on noisy channel</li>
<li>ID 165757: [Robustness] Dead lock during CSMA-CA sequence after several hours (depending number of frames send, noisy channel)</li>
<li>ID 167369: MAC &amp; Zigbee solution not Low Power compatible for sleepy end devices. System could stay in high power consumption and does not return back to standby low power consumption level.</li>
</ul></li>
<li><strong>Known limitations</strong>:
<ul>
<li>BLE:
<ul>
<li>ID 175965: Slave Latency is not applied correctly on FULL configuration</li>
<li>ID 162754: Scheduling issue while having an ongoing CIS may lead to non-handling of LLCP in time causing a Disconnection with “Instant passed”</li>
<li>ID 143245: ACI_HAL_GET_ANCHOR_PERIOD, ACI_HAL_SET_SLAVE_LATENCY not yet supported.<br />
</li>
<li>ID 168123: MIC failure when initiating an LE Power Control request during an encryption procedure.</li>
<li>ID 172235: RSSI miscalculation in CIG Event.</li>
</ul></li>
<li>BLE Audio:
<ul>
<li>Framed mode not supported (44.1 KHz)</li>
<li>ID 135240 : Long synchronization time in Broadcast due to scheduling conflict between extended advertising and BIG event<br />
</li>
<li>ID 165710 : Audio Latency may not be respected with high transport latency</li>
</ul></li>
<li>Thread:
<ul>
<li>ID 173756: [Robustness] Dead lock after 36 hours, timer overflow</li>
<li>ID 172831: RCP CSL Tx instability</li>
<li>ID 174323: [CSL] Enh-Ack timestamp calculation issue / radio crash</li>
</ul></li>
<li>MAC 802.15.4:
<ul>
<li>ID 164074: Coordinator receiveSyncLoss.IndicationduringCoord_realign</li>
<li>ID 171812: [Robustness] Data.cnfreceived bad error code (CHANNEL_ACCESS_FAILLURE normally NO_ACK)</li>
<li>ID 173756: [Robustness] Dead lock after 36 hours, timer overflow</li>
</ul></li>
<li>PHY 802.15.4:
<ul>
<li>ID 160933: API for continuous wave not yet supported</li>
<li>ID 160930: API for continuous modulation not yet supported</li>
<li>ID 164825: RSSI reading incorrect: around 6dbm loss from –90 to -30dbm</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div class="collapse">
<input type="checkbox" id="collapse-section4" aria-hidden="true"> <label for="collapse-section4" aria-hidden="false">V2.3.0 / 05-Feb-2024</label>
<div>
<h2 id="main-changes-1">Main Changes</h2>
<ul>
<li><p>Adding support of BLE-Thread and BLE-Zigbee Dynamic Concurrent Modes.</p></li>
<li><p>All libraries are now compiled with MDK-ARM (KEIL) ARMCLANG V6.19 AEABI format.</p></li>
<li>BLE:
<ul>
<li>New features supported:
<ul>
<li>Connection Subrating</li>
<li>Channel Classification Enhancement</li>
<li>Periodic Advertising Enhancement</li>
</ul></li>
<li>Issues fixed :
<ul>
<li>ID 161043: Periodic advertising list entries not used properly during periodic advertising synchronization.</li>
<li>ID 165155: ACL Data packet not cleared correctly if disconnection occurred and ACL Data couldn’t be sent.</li>
<li>ID 160222: Maximum ATT MTU limited to 362 bytes.</li>
<li>ID 168842: Wrong RSSI calculation</li>
<li>ID 164684: Issue in SMP Pairing if Central received SMP Pairing Public Key and Pairing Confirm packets in the same Connection Event.</li>
<li>ID 162525: HardFault happens when sending ISO Data from BIS Broadcaster with PTO &gt; 0 and Encryption enabled</li>
<li>ID 168913: Issue when mixing LE Credit Based Flow Control mode and Enhanced Credit Based Flow Control Mode</li>
</ul></li>
</ul></li>
<li>BLE Audio:
<ul>
<li>Release of the Generic Audio Framework with support CAP Initiator, Commander and Acceptor roles (ble_audio.a V1.1) (inc. CAP, BAP,CCP,MCP,VCP,MICP,CSIP) compiled by ARMCLANG V6.19<br />
</li>
<li>Change codec library extension to LC3.a (V1.3)<br />
</li>
<li>Release of codec_manager V1.1 (adapted for LC3 V1.3)</li>
</ul></li>
<li>Zigbee:
<ul>
<li>Several fixes and enhancement has been introduced in the Zigbee stack library including:
<ul>
<li>Cleaning the ZbZgpProxyBasicCommandReq before rejoining a new network</li>
<li>Parent Link Failure is now triggred for every EDKA failure.</li>
<li>Added ZB_MSG_STACK_EVENT_PARENT_LINK_FAIL, to separate out ZB_MSG_STACK_EVENT_ATTEMPT_REJOIN which is called on a NWK Leave with rejoin bit set.<br />
</li>
<li>Application can now more easily distinguish aParent Link Failure from a Leave with Rejoin.</li>
</ul></li>
<li>Several fixes and enhancement has been introduced in the Zigbee cluster library including:
<ul>
<li>Rework of the Zbcli SE Messaging cluster.</li>
<li>Code cleaning in order to comply with MISRA rules</li>
</ul></li>
</ul></li>
<li>Thread:
<ul>
<li>OT stack update to SHA-1 : 8bc25042ba5cde20605eec2a329c0dff575303f4 (07/07/2023).</li>
<li><p>OT RCP (Radio Co-Processor) support.</p></li>
<li>Issues fixed:
<ul>
<li>ID 167850 - Linklayer compatibility with OT 8bc25042ba5cde20605eec2a329c0dff575303f4 (OT stack update)</li>
<li>ID 167322 - OT_RADIO_CAPS_CSMA_BACKOFF should be returned in otPlatRadioGetCaps() (RCP border router compatibility)</li>
<li>ID 143488 - Add RCP support</li>
<li>ID 162977 - OtPlatRadioTransmit() OT_ERROR_BUSY assert in OT stack (robustness improvement)</li>
<li>ID ID 164508 - llhwc_cmn_evnt_notify(EVNT_START) calls whereas radio already started (Low power SCM 16MHz to 32MHz now working)</li>
<li>ID 165748 - [WBA_Cut2.0_OpenThread] Exploring doesn’t working on WBA (cubeMonRf)</li>
</ul></li>
</ul></li>
<li>MAC 802.15.4:
<ul>
<li>MLME-SyncLoss.Indication is now supported.</li>
<li>Issues fixed :
<ul>
<li>ID 162221 - if device receives several beacons with same Panid beacon Notifications are provided to upper layer</li>
<li>ID 168643 - Implementation pending addresses completely delete</li>
<li>ID 170005 - CSMA sequence after No ACK</li>
</ul></li>
</ul></li>
<li><strong>Known limitations</strong>:
<ul>
<li>BLE:
<ul>
<li>ID 162754: Scheduling issue while having an ongoing CIS may lead to non-handling of LLCP in time causing a Disconnection with “Instant passed”</li>
<li>ID 143245: ACI_HAL_GET_ANCHOR_PERIOD, ACI_HAL_SET_SLAVE_LATENCY not yet supported.<br />
</li>
<li>ID 168123: MIC failure when initiating an LE Power Control request during an encryption procedure.</li>
<li>ID 172235: RSSI miscalculation in CIG Event.</li>
</ul></li>
<li>BLE Audio:
<ul>
<li>Framed mode not supported (44.1 KHz)</li>
<li>ID 135240 : Long synchronization time in Broadcast due to scheduling conflict between extended advertising and BIG event<br />
</li>
<li>ID 165710 : Audio Latency may not be respected with high transport latency</li>
</ul></li>
<li>Thread:
<ul>
<li>ID 165757: After ral_start_tx, we don’t receive ral_tx_done (robustness crash after few hours)</li>
<li>ID 165757: [Robustness] Dead lock during CSMA-CA sequence after several hours (depending number of frames send, noisy channel)</li>
</ul></li>
<li>MAC 802.15.4:
<ul>
<li>ID 167369: MAC &amp; Zigbee solution not Low Power compatible for sleepy end devices. System could stay in high power consumption and does not return back to standby low power consumption level.</li>
<li>ID 164074: Coordinator receive SyncLoss.Indication during Coord_realign</li>
<li>ID 165757: [Robustness] Dead lock during CSMA-CA sequence after several hours (depending number of frames send, noisy channel)</li>
<li>ID 171812: [Robustness] Data.cnf received bad error code (CHANNEL_ACCESS_FAILLURE normally NO_ACK)</li>
<li>ID 166793: [Robustness] Assert during active scan on noisy channel</li>
</ul></li>
<li>PHY 802.15.4:
<ul>
<li>ID 160933: API for continuous wave not yet supported</li>
<li>ID 160930: API for continuous modulation not yet supported</li>
<li>ID 164825: RSSI reading incorrect: around 6dbm loss from –90 to -30dbm</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div class="collapse">
<input type="checkbox" id="collapse-section3" aria-hidden="true"> <label for="collapse-section3" aria-hidden="false">V2.2.0 / 22-Sept-2023</label>
<div>
<h2 id="main-changes-2">Main Changes</h2>
<ul>
<li>BLE:
<ul>
<li>New features supported:
<ul>
<li>Enhanced ATT</li>
<li>Isochronous Broadcaster / Synchronizer</li>
<li>Connected Isochronous</li>
<li>LE Power Control(with autonomous request)</li>
</ul></li>
<li>Audio:
<ul>
<li>Initial release of the Generic Audio Framework with support CAP Initiator, Commander and Acceptor roles (ble_audio.a V0.6) (inc. CAP, BAP,CCP,MCP,VCP,MICP,CSIP).</li>
<li>Initial release faster LC3.lib (V1.3) compiled by ARMCLANG V6.14.1</li>
<li>Initial release of codec_manager V0.6 adapted for LC3 V1.3</li>
</ul></li>
</ul></li>
<li>Zigbee:
<ul>
<li>Initial release supporting:
<ul>
<li>Zigbee stack compliant with latest Zigbee R23 revision.</li>
<li>Zigbee Clusters library (ZCL 8.0 compliant). On demand, those clusters may be provided in source code.</li>
</ul></li>
</ul></li>
<li>Thread:
<ul>
<li>Initial release supporting GRL Tests pre-certified on OT 1.1 / 1.2 / 1.3</li>
</ul></li>
<li>MAC 802.15.4:
<ul>
<li>Initial release supporting Zigbee IEEE 802.15.4 MAC Test Plan V 2.0 - ZigBee IEEE 802.15.4 Test Specification 14-0332-01 (pre-certified)</li>
</ul></li>
<li>Known limitations:
<ul>
<li>BLE:
<ul>
<li>ID 143245: ACI_HAL_GET_ANCHOR_PERIOD, ACI_HAL_SET_SLAVE_LATENCY not yet supported.</li>
<li>ID 161043: Periodic advertising list entries not used properly during periodic advertising synchronization.</li>
<li>ID 156915: Incorrect handling of the interruption of a PHY update procedure or a connection update procedure, by another LL control</li>
<li>ID 150795/151333: Sleep timer overflow (each 36h) stops Audio RF activities ongoing.</li>
</ul></li>
<li>BLE Audio:
<ul>
<li>Framed mode not supported</li>
<li>ID 154525: conflict on air may lead to a drift on audio latency</li>
<li>Generic Audio Framework not certified yet</li>
</ul></li>
<li>Zigbee:
<ul>
<li>Zigbee stack not yet certified</li>
</ul></li>
<li>MAC 802.15.4:
<ul>
<li>MAC_SECURITY not yet supported.</li>
<li>PAN_ID_CONFLICT feature not yet supported</li>
</ul></li>
<li>PHY 802.15.4:
<ul>
<li>ID 160933: API for continuous wave not yet supported</li>
<li>ID 160930: API for continuous modulation not yet supported</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div class="collapse">
<input type="checkbox" id="collapse-section2" aria-hidden="true"> <label for="collapse-section2" aria-hidden="false">V2.1.0 / 30-May-2023</label>
<div>
<h2 id="main-changes-3">Main Changes</h2>
<ul>
<li>BLE:
<ul>
<li>Maximum number of simultaneous connections supported by the device is now 20: requires library LinkLayer_BLE_Basic_20_links_lib.a</li>
<li>New RF-PHY settings which allow to pass FCC regulatory requirements (specifically FCC Band edge measurement) have been integrated</li>
<li>Add ble_legacy.h include: file which ensures the compatibility with previous BLE Stack naming.</li>
<li>Update BLE types and names in include files.</li>
<li>ID 143688: Radio Deep Sleep mode can be used with white lists, resolving lists or periodic advertiser lists.</li>
<li>ID 143240: Calibration improvement:calibration is done channel by channel from radio interrupt. Calibration is not delaying Link Layer scheduling activities. </li>
<li>ID 146629: Fix issue of events conflict with multi links.</li>
<li>ID 144736: Scan response Data handled correctly when it is set after the advertising enabling.</li>
<li>ID 149353: Channel Map update wrong behavior fixed.</li>
</ul></li>
<li>Known limitations:
<ul>
<li>ID 144495: Radio Calibration is not supported on standby mode.</li>
<li>ID 143245: ACI_HAL_GET_ANCHOR_PERIOD, ACI_HAL_SET_SLAVE_LATENCY not yet supported.</li>
<li>ID 145802: Pairing request fails with error SMP timeout when connection interval set to max value: 4s.</li>
<li>ID 150795/151333: Sleep timer overflow (each 36h) stops RF activities ongoing.</li>
<li>ID 150914: Wrong CONNECT_IND packet not correctly handled.</li>
</ul></li>
</ul>
</div>
</div>
<div class="collapse">
<input type="checkbox" id="collapse-section1" aria-hidden="true"> <label for="collapse-section1" aria-hidden="false">V2.0.0 / 08-February-2023</label>
<div>
<h2 id="main-changes-4">Main Changes</h2>
<p>First official release for WBA</p>
<ul>
<li>Known limitations:
<ul>
<li>ID 143688: Radio Deep Sleep mode shall not be used if we want to use white lists, resolving lists or periodic advertiser lists.</li>
<li>ID 144507: The BleStack_Process function should also be called when a BLE stack callback function is called by the platform software(PKA, timer).</li>
<li>ID 143393: [THREADX] RNG and PKA tasks priorities must be higher than BLE Host stack task.</li>
<li>ID 143395: [THREADX] No Uart traces supported while in low power modes.</li>
<li>ID 144495: Radio Calibration is not supported on standby mode.</li>
<li>ID 143245: ACI_HAL_GET_ANCHOR_PERIOD, ACI_HAL_SET_SLAVE_LATENCY not yet supported.</li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>
</body>
</html>
